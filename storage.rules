rules_version = '2';

// Firebase Storage セキュリティルール
service firebase.storage {
  match /b/{bucket}/o {
    // 事業所ロゴのアップロード
    match /organizations/{organizationId}/{fileName} {
      // 読み取り: 認証済みユーザーのみ
      allow read: if request.auth != null;

      // 書き込み: 認証済みユーザーのみ
      // ファイルサイズ: 5MB以下
      // ファイル形式: 画像のみ（JPEG, PNG, WebP）
      allow write: if request.auth != null
                   && request.resource.size <= 5 * 1024 * 1024
                   && request.resource.contentType.matches('image/(jpeg|jpg|png|webp)');

      // 削除: 認証済みユーザーのみ
      allow delete: if request.auth != null;
    }

    // 将来的な拡張用: スタッフプロフィール画像
    match /staff/{staffId}/{fileName} {
      allow read: if request.auth != null;
      allow write: if request.auth != null
                   && request.resource.size <= 5 * 1024 * 1024
                   && request.resource.contentType.matches('image/(jpeg|jpg|png|webp)');
      allow delete: if request.auth != null;
    }

    // 将来的な拡張用: 利用者プロフィール画像
    match /clients/{clientId}/{fileName} {
      allow read: if request.auth != null;
      allow write: if request.auth != null
                   && request.resource.size <= 5 * 1024 * 1024
                   && request.resource.contentType.matches('image/(jpeg|jpg|png|webp)');
      allow delete: if request.auth != null;
    }

    // コミュニティ投稿画像
    match /posts/{fileName} {
      // 読み取り: 認証済みユーザーのみ
      allow read: if request.auth != null;

      // 書き込み: 認証済みユーザーのみ
      // ファイルサイズ: 5MB以下
      // ファイル形式: 画像のみ（JPEG, PNG, WebP）
      allow write: if request.auth != null
                   && request.resource.size <= 5 * 1024 * 1024
                   && request.resource.contentType.matches('image/(jpeg|jpg|png|webp)');

      // 削除: 認証済みユーザーのみ
      allow delete: if request.auth != null;
    }

    // その他のファイルはデフォルトで拒否
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}
